<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏è‡∏Å - Tripitaka PWA</title>
  <!--VERSION:manifest-->
  <link rel="manifest" href="manifest.json?v=VERSION_PLACEHOLDER">
  <!--/VERSION-->
  <meta name="theme-color" content="#f59e0b">
  <meta name="description" content="‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏è‡∏Å ‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£ - Tripitaka PWA">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìø</text></svg>">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Sarabun', 'Noto Sans TH', sans-serif;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 600px; margin: 0 auto; }
    h1 { text-align: center; color: #92400e; margin-bottom: 8px; font-size: 1.8rem; }
    .subtitle { text-align: center; color: #b45309; margin-bottom: 20px; font-size: 0.9rem; }
    .breadcrumb {
      background: white;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 0.85rem;
      color: #666;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .breadcrumb span { color: #d97706; cursor: pointer; }
    .breadcrumb span:hover { text-decoration: underline; }
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s;
    }
    .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .card-header { display: flex; justify-content: space-between; align-items: center; }
    .card h3 { color: #92400e; font-size: 1.1rem; }
    .card .count {
      background: #f59e0b;
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
    }
    .card p { color: #666; font-size: 0.9rem; margin-top: 8px; }
    .icon { margin-right: 8px; }
    .back-btn {
      display: inline-block;
      background: #f59e0b;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 15px;
      font-size: 0.9rem;
    }
    .back-btn:hover { background: #d97706; }
    .hidden { display: none; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>üìø ‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏è‡∏Å</h1>
    <p class="subtitle">‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£</p>
    
    <div id="breadcrumb" class="breadcrumb hidden">
      <span onclick="goHome()">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span> <span id="breadcrumb-text"></span>
    </div>
    
    <div id="content"></div>
  </div>

  <script>
    const data = {
      councils: [
        {
          id: 1,
          name: '‡∏õ‡∏ê‡∏°‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤',
          year: '400 ‡∏Å‡πà‡∏≠‡∏ô‡∏û.‡∏®.',
          location: '‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏£‡∏≤‡∏ä‡∏Ñ‡∏§‡∏´‡πå',
          participants: '‡∏û‡∏£‡∏∞‡∏≠‡∏£‡∏´‡∏±‡∏ô‡∏ï‡πå 500 ‡∏£‡∏π‡∏õ',
          nikayas: [
            { name: '‡∏ó‡∏µ‡∏Ü‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', thai: 'Digha Nikaya', count: 34, desc: '‡∏™‡∏π‡∏ï‡∏£‡∏¢‡∏≤‡∏ß ‡∏ò‡∏£‡∏£‡∏°‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å', 
              sutras: [
                { name: '‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£ 1 - ‡∏ö‡∏≤‡∏•‡∏µ', desc: '‡∏ò‡∏£‡∏£‡∏°‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏à‡πâ‡∏á' },
                { name: '‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£ 2 - ‡∏™‡∏≤‡∏°‡∏ß‡∏±‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï', desc: '‡∏ß‡∏¥‡∏ñ‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' },
                { name: '‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£ 3 - ‡πÇ‡∏™‡∏ï‡∏≤‡∏õ‡∏õ‡∏≤‡∏ô‡∏™‡∏π‡∏ï‡∏£', desc: '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏™‡∏ï‡∏≤‡∏õ‡∏õ‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏í‡πà‡∏≤' }
              ] },
            { name: '‡∏°‡∏±‡∏ä‡∏å‡∏¥‡∏°‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', thai: 'Majjhima Nikaya', count: 152, desc: '‡∏™‡∏π‡∏ï‡∏£‡∏Å‡∏•‡∏≤‡∏á ‡∏™‡∏≠‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥',
              sutras: [
                { name: '‡∏°‡∏´‡∏≤‡∏ä‡∏≤‡∏î‡∏Å', desc: '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏°‡∏´‡∏≤‡∏ä‡∏≤‡∏î‡∏Å' },
                { name: '‡πÄ‡∏ï‡∏ä‡∏±‡∏™‡∏™‡∏π‡∏ï‡∏£', desc: '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏µ‡∏¢‡∏£' },
                { name: '‡∏≠‡∏ô‡∏∏‡∏õ‡∏∏‡∏û‡∏û‡∏¥‡∏™‡∏π‡∏ï‡∏£', desc: '‡∏ê‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏¢‡∏Å‡∏¢‡πà‡∏≠‡∏á' }
              ] },
            { name: '‡∏™‡∏±‡∏á‡∏¢‡∏∏‡∏ï‡∏ï‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', thai: 'Samyutta Nikaya', count: 2889, desc: '‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà',
              sutras: [
                { name: '‡∏™‡∏±‡∏á‡∏¢‡∏∏‡∏ï‡∏ï‡πå ‡∏™‡∏Ñ‡∏≤‡∏ñ‡∏ß‡∏£‡∏£‡∏Ñ', desc: '‡∏Ñ‡∏≤‡∏ñ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ' },
                { name: '‡∏™‡∏±‡∏á‡∏¢‡∏∏‡∏ï‡∏ï‡πå ‡∏ô‡∏¥‡πÄ‡∏ß‡∏®‡∏ß‡∏£‡∏£‡∏Ñ', desc: '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°' }
              ] },
            { name: '‡∏≠‡∏±‡∏á‡∏Ñ‡∏∏‡∏ï‡∏ï‡∏£‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', thai: 'Anguttara Nikaya', count: 2308, desc: '‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç',
              sutras: [
                { name: '‡πÄ‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ç‡πå', desc: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡πå 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á' },
                { name: '‡∏ó‡∏∏‡∏Å‡∏Ç‡πå 2', desc: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡πå 2 ‡∏≠‡∏¢‡πà‡∏≤‡∏á' }
              ] },
            { name: '‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', thai: 'Khuddaka Nikaya', count: 15, desc: '‡∏Ñ‡∏±‡∏°‡∏†‡∏µ‡∏£‡πå‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î',
              sutras: [
                { name: '‡∏ò‡∏£‡∏£‡∏°‡∏à‡∏±‡∏Å‡∏£', desc: '‡∏ß‡∏á‡∏à‡∏£‡∏ò‡∏£‡∏£‡∏°' },
                { name: '‡∏à‡∏±‡∏Å‡∏Å‡∏±‡∏ö‡∏ß‡∏∞', desc: '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 4 ‡∏Ç‡πâ‡∏≠' }
              ] }
          ],
          abhidharma: [
            { name: '‡∏ò‡∏±‡∏°‡∏°‡∏™‡∏±‡∏á‡∏Ñ‡∏ì‡∏∞', desc: '‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ò‡∏£‡∏£‡∏° 121 ‡∏≠‡∏¢‡πà‡∏≤‡∏á' },
            { name: '‡∏ß‡∏¥‡∏†‡∏±‡∏á‡∏Ñ‡πå', desc: '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ò‡∏£‡∏£‡∏° 18 ‡∏ö‡∏ó' },
            { name: '‡∏ò‡∏±‡∏°‡∏°‡∏≤‡∏ï‡∏¥‡∏Å‡∏≤', desc: '‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ò‡∏£‡∏£‡∏°‡∏ï‡∏≤‡∏°‡∏ò‡∏≤‡∏ï‡∏∏' },
            { name: '‡∏õ‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ö‡∏π‡∏£‡∏ì‡∏∞', desc: '‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• 52 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó' },
            { name: '‡∏Å‡∏±‡∏ï‡∏ï‡∏¥‡∏à‡∏∏‡∏ó‡∏ò‡∏≤‡∏ô‡∏∞', desc: '‡∏Ç‡πâ‡∏≠‡∏ñ‡∏Å‡πÄ‡∏ñ‡∏µ‡∏¢‡∏á‡∏ó‡∏≤‡∏á‡∏ò‡∏£‡∏£‡∏°' },
            { name: '‡∏¢‡∏°‡∏Å', desc: '‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤' },
            { name: '‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', desc: '‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• 24 ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£' }
          ],
          vinaya: [
            { name: '‡∏õ‡∏≤‡∏à‡∏¥‡∏ï‡∏ö‡∏ó', count: 227, desc: '‡∏û‡∏£‡∏∞‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ 227 ‡∏Ç‡πâ‡∏≠' }
          ]
        },
        {
          id: 2,
          name: '‡∏ó‡∏∏‡∏ï‡∏¥‡∏¢‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤',
          year: '300 ‡∏Å‡πà‡∏≠‡∏ô‡∏û.‡∏®.',
          location: '‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏ß‡∏™‡∏≤‡∏•‡∏µ',
          participants: '‡∏û‡∏£‡∏∞‡∏≠‡∏£‡∏´‡∏±‡∏ô‡∏ï‡πå 700 ‡∏£‡∏π‡∏õ',
          description: '‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ 10 ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô',
          vinaya: [
            { name: '‡∏õ‡∏≤‡∏à‡∏¥‡∏ï‡∏ö‡∏ó', count: 227, desc: '‡∏û‡∏£‡∏∞‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ 227 ‡∏Ç‡πâ‡∏≠' }
          ]
        },
        {
          id: 3,
          name: '‡∏ï‡∏ï‡∏¥‡∏¢‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤',
          year: '250 ‡∏Å‡πà‡∏≠‡∏ô‡∏û.‡∏®.',
          location: '‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏õ‡∏≤‡∏è‡∏•‡∏µ‡∏ö‡∏∏‡∏ï‡∏£',
          participants: '‡∏û‡∏£‡∏∞‡∏≠‡∏£‡∏´‡∏±‡∏ô‡∏ï‡πå 1,000 ‡∏£‡∏π‡∏õ',
          description: '‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏´‡∏≤‡∏Å‡∏±‡∏™‡∏™‡∏õ‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô',
          nikayas: [
            { name: '‡∏ó‡∏µ‡∏Ü‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', count: 34, desc: '‡∏™‡∏π‡∏ï‡∏£‡∏¢‡∏≤‡∏ß' },
            { name: '‡∏°‡∏±‡∏ä‡∏å‡∏¥‡∏°‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', count: 152, desc: '‡∏™‡∏π‡∏ï‡∏£‡∏Å‡∏•‡∏≤‡∏á' },
            { name: '‡∏™‡∏±‡∏á‡∏¢‡∏∏‡∏ï‡∏ï‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', count: 2889, desc: '‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î' },
            { name: '‡∏≠‡∏±‡∏á‡∏Ñ‡∏∏‡∏ï‡∏ï‡∏£‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', count: 2308, desc: '‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç' },
            { name: '‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢', count: 15, desc: '‡∏Ñ‡∏±‡∏°‡∏†‡∏µ‡∏£‡πå‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î' }
          ],
          abhidharma: [
            { name: '‡∏ò‡∏±‡∏°‡∏°‡∏™‡∏±‡∏á‡∏Ñ‡∏ì‡∏∞', desc: '‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ò‡∏£‡∏£‡∏° 121' },
            { name: '‡∏ß‡∏¥‡∏†‡∏±‡∏á‡∏Ñ‡πå', desc: '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå 18 ‡∏ö‡∏ó' },
            { name: '‡∏ò‡∏±‡∏°‡∏°‡∏≤‡∏ï‡∏¥‡∏Å‡∏≤', desc: '‡∏ò‡∏≤‡∏ï‡∏∏' },
            { name: '‡∏õ‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ö‡∏π‡∏£‡∏ì‡∏∞', desc: '52 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó' },
            { name: '‡∏Å‡∏±‡∏ï‡∏ï‡∏¥‡∏à‡∏∏‡∏ó‡∏ò‡∏≤‡∏ô‡∏∞', desc: '‡∏ñ‡∏Å‡πÄ‡∏ñ‡∏µ‡∏¢‡∏á' },
            { name: '‡∏¢‡∏°‡∏Å', desc: '‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠' },
            { name: '‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', desc: '24 ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•' }
          ],
          vinaya: [
            { name: '‡∏õ‡∏≤‡∏à‡∏¥‡∏ï‡∏ö‡∏ó', count: 227, desc: '‡∏û‡∏£‡∏∞‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ 227 ‡∏Ç‡πâ‡∏≠' }
          ]
        }
      ],
      pitakas: [
        { id: 'vinaya', name: '‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏õ‡∏¥‡∏è‡∏Å', icon: '‚öñÔ∏è', desc: '‡∏Å‡∏é‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏£‡∏∞‡∏†‡∏¥‡∏Å‡∏©‡∏∏‡∏™‡∏á‡∏Ü‡πå' },
        { id: 'suttanta', name: '‡∏™‡∏∏‡∏ï‡∏ï‡∏±‡∏ô‡∏ï‡∏õ‡∏¥‡∏è‡∏Å', icon: 'üìñ', desc: '‡∏û‡∏£‡∏∞‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ó‡∏®‡∏ô‡∏≤ ‡∏Ñ‡∏≥‡∏™‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡πÄ‡∏à‡πâ‡∏≤' },
        { id: 'abhidharma', name: '‡∏≠‡∏†‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏õ‡∏¥‡∏è‡∏Å', icon: 'üß†', desc: '‡∏Ñ‡∏≥‡∏™‡∏≠‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏†‡∏≤‡∏©‡∏ß‡∏¥‡∏ò‡∏µ' }
      ]
    };

    let currentView = 'home';
    let currentCouncilId = null;
    let currentNikaya = null;
    let breadcrumbStack = [];

    function saveState() {
      localStorage.setItem('tripitaka_v3_view', currentView);
      localStorage.setItem('tripitaka_v3_council', currentCouncilId || '');
      localStorage.setItem('tripitaka_v3_nikaya', currentNikaya || '');
      
      if (currentView === 'home') {
        history.replaceState(null, '', window.location.pathname);
      } else if (currentView === 'council' && currentCouncilId) {
        history.replaceState(null, '', '#/council/' + currentCouncilId);
      } else if (currentView === 'council') {
        history.replaceState(null, '', '#/council');
      } else if (currentView === 'pitaka') {
        history.replaceState(null, '', '#/pitaka');
      } else if (currentView === 'nikaya' && currentCouncilId && currentNikaya) {
        history.replaceState(null, '', '#/council/' + currentCouncilId + '/' + encodeURIComponent(currentNikaya));
      }
    }

    function loadState() {
      const hash = window.location.hash;
      if (hash.startsWith('#/council/')) {
        const parts = hash.split('/');
        currentView = 'detail';
        currentCouncilId = parseInt(parts[2]);
        if (parts[3]) {
          currentNikaya = decodeURIComponent(parts[3]);
          currentView = 'nikaya';
        }
        return;
      } else if (hash === '#/council') {
        currentView = 'council';
        currentCouncilId = null;
        return;
      } else if (hash === '#/pitaka') {
        currentView = 'pitaka';
        currentCouncilId = null;
        return;
      }
      
      currentView = localStorage.getItem('tripitaka_v3_view') || 'home';
      currentCouncilId = localStorage.getItem('tripitaka_v3_council') || null;
      currentNikaya = localStorage.getItem('tripitaka_v3_nikaya') || null;
      if (currentCouncilId) currentCouncilId = parseInt(currentCouncilId);
    }

    function render() {
      const content = document.getElementById('content');
      const breadcrumb = document.getElementById('breadcrumb');
      
      if (currentNikaya && currentCouncilId) {
        showNikayaDetail(currentCouncilId, currentNikaya);
        return;
      }
      
      if (currentCouncilId) {
        showCouncilDetail(currentCouncilId);
        return;
      }
      
      if (currentView === 'home') {
        breadcrumb.classList.add('hidden');
        content.innerHTML = renderHome();
      } else if (currentView === 'council') {
        breadcrumb.classList.remove('hidden');
        document.getElementById('breadcrumb-text').innerHTML = ' > ‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤';
        content.innerHTML = renderCouncilList();
      } else if (currentView === 'pitaka') {
        breadcrumb.classList.remove('hidden');
        document.getElementById('breadcrumb-text').innerHTML = ' > <span onclick="showCouncil()">‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤</span> > ‡∏õ‡∏¥‡∏è‡∏Å';
        content.innerHTML = renderPitakaList();
      } else if (currentView === 'detail') {
        breadcrumb.classList.remove('hidden');
        content.innerHTML = '';
      }
    }

    function renderHome() {
      return `
        <div class="card" onclick="showCouncil()">
          <div class="card-header">
            <h3>üìú ‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤ 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</h3>
            <span class="count">3</span>
          </div>
          <p>‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏è‡∏Å 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡∏•‡∏≠‡∏î 150 ‡∏õ‡∏µ</p>
        </div>
        <div class="card" onclick="showPitaka()">
          <div class="card-header">
            <h3>üèõÔ∏è ‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏è‡∏Å 3 ‡∏õ‡∏¥‡∏è‡∏Å</h3>
            <span class="count">3</span>
          </div>
          <p>‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ ‡∏™‡∏∏‡∏ï‡∏ï‡∏±‡∏ô‡∏ï‡πå ‡πÅ‡∏•‡∏∞‡∏≠‡∏†‡∏¥‡∏ò‡∏£‡∏£‡∏°</p>
        </div>
      `;
    }

    function renderCouncilList() {
      return data.councils.map(c => `
        <div class="card" onclick="showCouncilDetail(${c.id})">
          <div class="card-header">
            <h3>${c.id}. ${c.name}</h3>
            <span class="count">${c.year}</span>
          </div>
          <p>üìç ${c.location}</p>
          <p>üë§ ${c.participants}</p>
          ${c.description ? `<p>${c.description}</p>` : ''}
          ${c.nikayas ? `<p class="count" style="display:inline-block;margin-top:8px;">‡∏™‡∏∏‡∏ï‡∏ï‡∏±‡∏ô‡∏ï‡πå 5 ‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢</p>` : ''}
          ${c.abhidharma ? `<p class="count" style="display:inline-block;margin-top:8px;margin-left:8px;">‡∏≠‡∏†‡∏¥‡∏ò‡∏£‡∏£‡∏° 7 ‡∏Ñ‡∏±‡∏°‡∏†‡∏µ‡∏£‡πå</p>` : ''}
          ${c.vinaya ? `<p class="count" style="display:inline-block;margin-top:8px;margin-left:8px;">‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏õ‡∏¥‡∏è‡∏Å</p>` : ''}
        </div>
      `).join('');
    }

    function renderPitakaList() {
      return data.pitakas.map(p => `
        <div class="card" onclick="alert('‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ${p.name}')">
          <div class="card-header">
            <h3>${p.icon} ${p.name}</h3>
          </div>
          <p>${p.desc}</p>
        </div>
      `).join('');
    }

    function showCouncil() {
      currentView = 'council';
      currentCouncilId = null;
      saveState();
      render();
    }

    function showPitaka() {
      currentView = 'pitaka';
      saveState();
      render();
    }

    function showCouncilDetail(id) {
      currentCouncilId = id;
      currentNikaya = null;
      currentView = 'detail';
      const council = data.councils.find(c => c.id === id);
      const breadcrumb = document.getElementById('breadcrumb');
      breadcrumb.classList.remove('hidden');
      document.getElementById('breadcrumb-text').innerHTML = ' > <span onclick="showCouncil()">‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤</span> > ' + council.name;
      saveState();
      
      let html = `
        <div class="back-btn" onclick="showCouncil()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</div>
        <div class="card">
          <h2>${council.name}</h2>
          <p><strong>‡∏õ‡∏µ:</strong> ${council.year}</p>
          <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô:</strong> ${council.location}</p>
          <p><strong>‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°:</strong> ${council.participants}</p>
          ${council.description ? `<p>${council.description}</p>` : ''}
        </div>
      `;
      
      if (council.nikayas) {
        html += `
          <h3 style="color:#92400e;margin:20px 0 10px;">üìñ ‡∏™‡∏∏‡∏ï‡∏ï‡∏±‡∏ô‡∏ï‡∏õ‡∏¥‡∏è‡∏Å - ‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢</h3>
          ${council.nikayas.map((n, idx) => `
            <div class="card" onclick="showNikayaDetail(${c.id}, '${n.name}')">
              <div class="card-header">
                <h3>${n.name}</h3>
                <span class="count">${n.count} ‡∏™‡∏π‡∏ï‡∏£</span>
              </div>
              <p>${n.thai || ''}</p>
              <p>${n.desc}</p>
            </div>
          `).join('')}
        `;
      }
      
      if (council.abhidharma) {
        html += `
          <h3 style="color:#92400e;margin:20px 0 10px;">üß† ‡∏≠‡∏†‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏õ‡∏¥‡∏è‡∏Å</h3>
          ${council.abhidharma.map(a => `
            <div class="card">
              <h3>${a.name}</h3>
              <p>${a.desc}</p>
            </div>
          `).join('')}
        `;
      }
      
      if (council.vinaya) {
        html += `
          <h3 style="color:#92400e;margin:20px 0 10px;">‚öñÔ∏è ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏õ‡∏¥‡∏è‡∏Å</h3>
          ${council.vinaya.map(v => `
            <div class="card">
              <div class="card-header">
                <h3>${v.name}</h3>
                <span class="count">${v.count} ‡∏Ç‡πâ‡∏≠</span>
              </div>
              <p>${v.desc}</p>
            </div>
          `).join('')}
        `;
      }
      
      document.getElementById('content').innerHTML = html;
    }

    function showNikayaDetail(councilId, nikayaName) {
      const council = data.councils.find(c => c.id === councilId);
      const nikaya = council.nikayas.find(n => n.name === nikayaName);
      currentCouncilId = councilId;
      currentNikaya = nikayaName;
      currentView = 'nikaya';
      
      const breadcrumb = document.getElementById('breadcrumb');
      breadcrumb.classList.remove('hidden');
      document.getElementById('breadcrumb-text').innerHTML = 
        ' > <span onclick="showCouncil()">‡∏™‡∏±‡∏á‡∏Ñ‡∏¢‡∏≤‡∏ô‡∏≤</span> > <span onclick="showCouncilDetail(' + councilId + ')">' + council.name + '</span> > ' + nikayaName;
      saveState();
      
      let html = `
        <div class="back-btn" onclick="showCouncilDetail(${councilId})">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</div>
        <div class="card">
          <h2>${nikaya.name}</h2>
          <p>${nikaya.thai || ''}</p>
          <p>${nikaya.desc}</p>
          <p class="count" style="display:inline-block;margin-top:8px;">${nikaya.count} ‡∏™‡∏π‡∏ï‡∏£</p>
        </div>
        <h3 style="color:#92400e;margin:20px 0 10px;">üìú ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ï‡∏£</h3>
      `;
      
      if (nikaya.sutras && nikaya.sutras.length > 0) {
        html += nikaya.sutras.map(s => `
          <div class="card">
            <h3>${s.name}</h3>
            <p>${s.desc}</p>
          </div>
        `).join('');
      } else {
        html += '<div class="card"><p>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï...</p></div>';
      }
      
      document.getElementById('content').innerHTML = html;
    }

    function goHome() {
      currentView = 'home';
      currentCouncilId = null;
      saveState();
      render();
    }

    loadState();
    render();

    // Handle browser back/forward and hash changes
    window.addEventListener('hashchange', () => {
      loadState();
      render();
    });

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js?v=VERSION_PLACEHOLDER');
    }
  </script>
</body>
</html>
